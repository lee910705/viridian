<!DOCTYPE html>
<h2>Calendar</h2>
<head>
    <meta charset="utf-8">
    <title>d3 | reusable heatmap calendar</title>

    <link rel="stylesheet" href="/calendar/main.css">
</head>
<body>
<button type="submit" ng-click="getData()";>Retrieve Data</button>
<div>

    <style>
        @import url(//d3js.org/colorbrewer.v1.css);

        svg {
            font: 10px sans-serif;
        }

        .day {
            fill: #fff;
            stroke: #ccc;
        }

        .month {
            fill: none;
            stroke: #000;
            stroke-width: 2px;
        }
    </style>
    <body>
        <script src="//d3js.org/d3.v3.min.js"></script>
        <script>

            var margin = {top: 5.5, right: 0, bottom: 5.5, left: 19.5},
                width = 960 - margin.left - margin.right,
                height = 130 - margin.top - margin.bottom,
                size = height / 7;

            var day = function(d) { return (d.getDay() + 6) % 7; }, // monday = 0
                week = d3.time.format("%W"), // monday-based week number
                date = d3.time.format("%Y-%m-%d"),
                percent = d3.format("+.1%");

            var color = d3.scale.quantize()
                .domain([-.05, .05])
                .range(d3.range(9));

            var svg = d3.select("body").selectAll("svg")
                .data(d3.range(2016, 2017))
              .enter().append("svg")
                .attr("class", "RdYlGn")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
              .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            svg.append("text")
                .attr("transform", "translate(-6," + size * 3.5 + ")rotate(-90)")
                .attr("text-anchor", "middle")
                .text(function(d) { return d; });

            var rect = svg.selectAll(".day")
                .data(function(d) { return d3.time.days(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
              .enter().append("rect")
                .attr("class", "day")
                .attr("width", size)
                .attr("height", size)
                .attr("x", function(d) { return week(d) * size; })
                .attr("y", function(d) { return day(d) * size; })
                .datum(date);

            rect.append("title")
                .text(function(d) { return d; });

            svg.selectAll(".month")
                .data(function(d) { return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
              .enter().append("path")
                .attr("class", "month")
                .attr("d", monthPath);

            d3.csv("dji.csv", function(csv) {
              var data = d3.nest()
                .key(function(d) { return d.Date; })
                .rollup(function(d) { return (d[0].Close - d[0].Open) / d[0].Open; })
                .map(csv);

              rect.filter(function(d) { return d in data; })
                  .attr("class", function(d) { return "day q" + color(data[d]) + "-9"; })
                .select("title")
                  .text(function(d) { return d + ": " + percent(data[d]); });
            });

            function monthPath(t0) {
              var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),
                  d0 = +day(t0), w0 = +week(t0),
                  d1 = +day(t1), w1 = +week(t1);
              return "M" + (w0 + 1) * size + "," + d0 * size
                  + "H" + w0 * size + "V" + 7 * size
                  + "H" + w1 * size + "V" + (d1 + 1) * size
                  + "H" + (w1 + 1) * size + "V" + 0
                  + "H" + (w0 + 1) * size + "Z";
            }

        </script>

        <!--   <article>
                <header>
                    <span id="info">info</span>
                </header>
                <section id="heatmap"></section>
            </article>




            <script> d3.eesur = {}; //namespace  </script>
            <script src="/calendar/d3_code_heatmap_cal.js"></script>
            <script>
          // *****************************************
          // render chart
          // *****************************************
          (function() {
              'use strict';

              var nestedData;
              var parseDate = d3.time.format('%Y-%m-%d').parse;

              // create chart
              var heatChart = d3.eesur.heatmap()
                  .colourRangeStart('#FDBB30')
                  .colourRangeEnd('#EE3124')
                  .height(800)
                  .startYear('2011')
                  .endYear('2016')
                  .on('_hover', function (d, i) {
                      var f = d3.time.format('%B %d, %Y');
                      d3.select('#info')
                          .text(function () {
                              return 'date: ' + f(d) + ' | value: ' + nestedData[d];
                          });
                  });

              // apply after nesting data
              /**d3.json('heatmap_data.json', function(error, data) {

                  if (error) return console.warn(error);

                  nestedData = d3.nest()
                      .key(function (d) { return parseDate(d.date.split(' ')[0]); })
                      .rollup(function (n) {
                          return d3.sum(n, function (d) {
                              return d.amount; // key
                          });
                      })
                      .map(data);

                  // console.log(nestedData);

                  // render chart
                  d3.select('#heatmap')
                      .datum(nestedData)
                      .call(heatChart);

              });
              **/
          }());

          d3.select(self.frameElement).style('height', '900px');

            </script>-->
        <p>Current programs</p>

        <li><a href="#/calendarEntry">Calendar program entry</a></li>

</div>
        <!--
<body>
    <style>
        body {
            font: 10px sans-serif;
            shape-rendering: crispEdges;
        }

        .day {
            fill: #fff;
            stroke: #ccc;
        }

        .month {
            fill: none;
            stroke: #000;
            stroke-width: 2px;
        }

        .RdYlGn .q0-11 {
            fill: rgb(165,0,38);
        }

        .RdYlGn .q1-11 {
            fill: rgb(215,48,39);
        }

        .RdYlGn .q2-11 {
            fill: rgb(244,109,67);
        }

        .RdYlGn .q3-11 {
            fill: rgb(253,174,97);
        }

        .RdYlGn .q4-11 {
            fill: rgb(254,224,139);
        }

        .RdYlGn .q5-11 {
            fill: rgb(255,255,191);
        }

        .RdYlGn .q6-11 {
            fill: rgb(217,239,139);
        }

        .RdYlGn .q7-11 {
            fill: rgb(166,217,106);
        }

        .RdYlGn .q8-11 {
            fill: rgb(102,189,99);
        }

        .RdYlGn .q9-11 {
            fill: rgb(26,152,80);
        }

        .RdYlGn .q10-11 {
            fill: rgb(0,104,55);
        }
    </style>

    <script src="//d3js.org/d3.v3.min.js"></script>
        <script>

            var width = 960,
                height = 136,
                cellSize = 17; // cell size

            var percent = d3.format(".1%"),
                format = d3.time.format("%Y-%m-%d");

            var color = d3.scale.quantize()
                .domain([-.05, .05])
                .range(d3.range(11).map(function(d) { return "q" + d + "-11"; }));

            var svg = d3.select("body").selectAll("svg")
                .data(d3.range(2015, 2017))
              .enter().append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("class", "RdYlGn")
              .append("g")
                .attr("transform", "translate(" + ((width - cellSize * 53) / 2) + "," + (height - cellSize * 7 - 1) + ")");

            svg.append("text")
                .attr("transform", "translate(-6," + cellSize * 3.5 + ")rotate(-90)")
                .style("text-anchor", "middle")
                .text(function(d) { return d; });

            var rect = svg.selectAll(".day")
                .data(function(d) { return d3.time.days(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
              .enter().append("rect")
                .attr("class", "day")
                .attr("width", cellSize)
                .attr("height", cellSize)
                .attr("x", function(d) { return d3.time.weekOfYear(d) * cellSize; })
                .attr("y", function(d) { return d.getDay() * cellSize; })
                .datum(format);

            rect.append("title")
                .text(function(d) { return d; });

            svg.selectAll(".month")
                .data(function(d) { return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
              .enter().append("path")
                .attr("class", "month")
                .attr("d", monthPath);

            d3.csv("dji.csv", function(error, csv) {
              if (error) throw error;

              var data = d3.nest()
                .key(function(d) { return d.Date; })
                .rollup(function(d) { return (d[0].Close - d[0].Open) / d[0].Open; })
                .map(csv);

              rect.filter(function(d) { return d in data; })
                  .attr("class", function(d) { return "day " + color(data[d]); })
                .select("title")
                  .text(function(d) { return d + ": " + percent(data[d]); });
            });

            function monthPath(t0) {
              var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),
                  d0 = t0.getDay(), w0 = d3.time.weekOfYear(t0),
                  d1 = t1.getDay(), w1 = d3.time.weekOfYear(t1);
              return "M" + (w0 + 1) * cellSize + "," + d0 * cellSize
                  + "H" + w0 * cellSize + "V" + 7 * cellSize
                  + "H" + w1 * cellSize + "V" + (d1 + 1) * cellSize
                  + "H" + (w1 + 1) * cellSize + "V" + 0
                  + "H" + (w0 + 1) * cellSize + "Z";
            }

        </script>-->

   </body>
 

    <!--<form>
      <input placeholder="DATE" ng-model="newDATE">
      <input placeholder="INPT" ng-model="newINPT">
      <input placeholder="PREF" ng-model="newPREF">
      <input placeholder="PH" ng-model="newPH">
      <input placeholder="EC" ng-model="newEC">
      <button type="submit" ng-click="addrunoff(newDATE, newINPT, newPREF, newPH, newEC);newDATE = null; newINPT = null; newPREF = null; newPH = null; newEC = null;">send</button>
    </form>


    <ul id="runoffs" ng-show="runoffs.length">
        <li ng-repeat="runoff in runoffs | reverse">{{runoff.DATE}}</li>
    </ul>
        -->
